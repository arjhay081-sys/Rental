<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin â€“ Bobby's Motorbike Rental</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        :root{
            --gold:#f4c430;--green:#25D366;--teal:#14b878;
            --red:#ff6b6b;--orange:#fb923c;
            --bg:#06090f;--card:rgba(255,255,255,0.04);
            --border:rgba(255,255,255,0.09);--muted:#888;
        }
        body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;min-height:100vh;}
        @keyframes spin{to{transform:rotate(360deg);}}
        @keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
        @keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
        @keyframes bellRing{0%,100%{transform:rotate(0);}15%{transform:rotate(-18deg);}30%{transform:rotate(18deg);}45%{transform:rotate(-10deg);}60%{transform:rotate(10deg);}75%{transform:rotate(0);}}

        /* TOPBAR */
        .topbar{background:rgba(6,9,15,0.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0.8rem 1.25rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;}
        .topbar-left{display:flex;align-items:center;gap:0.65rem;}
        .topbar img{height:34px;border-radius:8px;}
        .topbar-title{font-size:0.9rem;font-weight:800;}
        .topbar-title span{color:var(--gold);}
        .topbar-right{display:flex;align-items:center;gap:0.6rem;}
        .live-wrap{display:flex;align-items:center;gap:0.4rem;}
        .live-dot{width:8px;height:8px;background:var(--green);border-radius:50%;animation:pulse 2s infinite;}
        .live-label{color:var(--green);font-size:0.7rem;font-weight:800;letter-spacing:1px;text-transform:uppercase;}
        .icon-btn{background:transparent;border:1px solid var(--border);color:var(--muted);width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;flex-shrink:0;}
        .icon-btn:hover,.icon-btn.on{border-color:rgba(244,196,48,0.4);color:var(--gold);}
        .icon-btn svg{width:16px;height:16px;fill:currentColor;}
        .icon-btn.ring svg{animation:bellRing 0.6s ease;}
        .btn-logout{background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);color:var(--red);padding:0.4rem 0.85rem;border-radius:8px;font-size:0.8rem;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.35rem;transition:all 0.2s;}
        .btn-logout:hover{background:rgba(255,107,107,0.2);}
        .btn-logout svg{width:14px;height:14px;fill:var(--red);}

        /* MAIN */
        .main{max-width:1100px;margin:0 auto;padding:1.25rem;}

        /* STATS */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0.85rem;margin-bottom:1.25rem;}
        .stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1rem 1.1rem;display:flex;align-items:center;gap:0.9rem;animation:fadeUp 0.35s ease both;}
        .stat-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .stat-icon svg{width:18px;height:18px;}
        .stat-val{font-size:1.7rem;font-weight:900;line-height:1;}
        .stat-label{color:var(--muted);font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;margin-top:2px;}

        /* CONTROLS */
        .controls{display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;align-items:center;}
        .filter-btn{background:var(--card);border:1px solid var(--border);color:var(--muted);padding:0.38rem 0.85rem;border-radius:20px;font-size:0.78rem;font-weight:700;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:0.35rem;}
        .filter-btn.active{background:rgba(244,196,48,0.09);border-color:rgba(244,196,48,0.4);color:var(--gold);}
        .filter-btn .cnt{background:rgba(255,255,255,0.08);padding:1px 6px;border-radius:8px;font-size:0.68rem;}
        .filter-btn.active .cnt{background:rgba(244,196,48,0.18);}
        .divider{width:1px;height:24px;background:var(--border);margin:0 0.25rem;}

        /* SORT */
        .sort-wrap{display:flex;align-items:center;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;}
        .sort-label{color:var(--muted);font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;}
        .sort-btn{background:var(--card);border:1px solid var(--border);color:var(--muted);padding:0.38rem 0.85rem;border-radius:8px;font-size:0.78rem;font-weight:700;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:0.35rem;}
        .sort-btn.active{background:rgba(244,196,48,0.09);border-color:rgba(244,196,48,0.4);color:var(--gold);}
        .sort-btn svg{width:12px;height:12px;fill:currentColor;}

        /* BOOKING CARDS */
        .list{display:grid;gap:0.85rem;}
        .bcard{background:var(--card);border:1px solid var(--border);border-left:3px solid var(--gold);border-radius:14px;overflow:hidden;animation:fadeUp 0.3s ease both;}
        .bcard.tour{border-left-color:var(--teal);}
        .bcard.approved{border-left-color:var(--green);}
        .bcard.rejected{border-left-color:var(--red);}

        .bcard-top{padding:0.85rem 1.1rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:0.5rem;flex-wrap:wrap;}
        .bcard-top-left{display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;}
        .badge-type{font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;padding:2px 7px;border-radius:5px;}
        .badge-type.bike{background:rgba(244,196,48,0.12);color:var(--gold);border:1px solid rgba(244,196,48,0.3);}
        .badge-type.tour{background:rgba(20,184,120,0.1);color:var(--teal);border:1px solid rgba(20,184,120,0.3);}
        .bid{font-size:0.92rem;font-weight:800;}
        .badge-status{font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;padding:2px 9px;border-radius:20px;}
        .badge-status.pending{background:rgba(251,146,60,0.12);color:var(--orange);border:1px solid rgba(251,146,60,0.3);}
        .badge-status.approved{background:rgba(37,211,102,0.1);color:var(--green);border:1px solid rgba(37,211,102,0.3);}
        .badge-status.rejected{background:rgba(255,107,107,0.1);color:var(--red);border:1px solid rgba(255,107,107,0.3);}
        .bcard-right{display:flex;align-items:center;gap:0.6rem;}
        .card-time{color:var(--muted);font-size:0.7rem;white-space:nowrap;}
        .btn-expand{background:transparent;border:none;color:var(--muted);font-size:0.75rem;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.25rem;padding:0.2rem 0;transition:color 0.2s;}
        .btn-expand:hover{color:var(--gold);}
        .btn-expand svg{width:13px;height:13px;fill:currentColor;transition:transform 0.25s;}
        .btn-expand.open svg{transform:rotate(180deg);}

        .bcard-body{padding:0.85rem 1.1rem;display:grid;grid-template-columns:repeat(3,1fr);gap:0.75rem;}
        .cf label{display:block;color:var(--muted);font-size:0.63rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:2px;}
        .cf span{color:#fff;font-size:0.85rem;font-weight:600;}
        .cf span.gold{color:var(--gold);}
        .cf span.teal{color:var(--teal);}

        .extra{max-height:0;overflow:hidden;transition:max-height 0.3s ease;}
        .extra.open{max-height:200px;}
        .extra-inner{padding:0.85rem 1.1rem;border-top:1px solid var(--border);display:grid;grid-template-columns:repeat(3,1fr);gap:0.75rem;}

        .bcard-actions{padding:0.75rem 1.1rem;border-top:1px solid var(--border);display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;}
        .btn-approve{background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.35);color:var(--green);padding:0.5rem 1rem;border-radius:8px;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:0.35rem;}
        .btn-approve:hover{background:rgba(37,211,102,0.2);}
        .btn-reject{background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);color:var(--red);padding:0.5rem 1rem;border-radius:8px;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:0.35rem;}
        .btn-reject:hover{background:rgba(255,107,107,0.2);}
        .btn-dl{background:rgba(244,196,48,0.1);border:1px solid rgba(244,196,48,0.3);color:var(--gold);padding:0.5rem 1rem;border-radius:8px;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:0.35rem;margin-left:auto;}
        .btn-dl:hover{background:rgba(244,196,48,0.2);}
        .btn-del{background:transparent;border:1px solid rgba(255,107,107,0.15);color:#555;padding:0.5rem 0.65rem;border-radius:8px;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;}
        .btn-del:hover{background:rgba(255,107,107,0.1);border-color:rgba(255,107,107,0.4);color:var(--red);}
        .btn-del svg,.btn-approve svg,.btn-reject svg,.btn-dl svg{width:14px;height:14px;fill:currentColor;}
        .note-text{color:var(--muted);font-size:0.76rem;font-style:italic;}

        /* STATES */
        .state-box{text-align:center;padding:3.5rem 1.5rem;color:var(--muted);}
        .state-box svg{width:40px;height:40px;fill:currentColor;opacity:0.3;display:block;margin:0 auto 1rem;}
        .state-box h3{font-size:1rem;margin-bottom:0.4rem;color:#666;}
        .spinner-wrap{text-align:center;padding:3rem;}
        .spinner{width:30px;height:30px;border:3px solid rgba(244,196,48,0.15);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 1rem;}

        /* ACTION MODAL */
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:300;padding:1rem;}
        .overlay.show{display:flex;}
        .modal{background:#0d1117;border:1px solid var(--border);border-radius:18px;padding:1.75rem;max-width:440px;width:100%;position:relative;animation:fadeUp 0.25s ease;}
        .modal::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;border-radius:18px 18px 0 0;}
        .modal.approve::before{background:linear-gradient(90deg,transparent,var(--green),transparent);}
        .modal.reject::before{background:linear-gradient(90deg,transparent,var(--red),transparent);}
        .modal h3{font-size:1.1rem;font-weight:800;margin-bottom:0.35rem;}
        .modal h3.g{color:var(--green);}
        .modal h3.r{color:var(--red);}
        .modal p{color:var(--muted);font-size:0.83rem;margin-bottom:1.1rem;}
        .modal textarea{width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:10px;padding:0.8rem;color:#fff;font-size:0.85rem;resize:vertical;min-height:80px;outline:none;font-family:inherit;transition:border-color 0.2s;}
        .modal textarea:focus{border-color:rgba(244,196,48,0.4);}
        .modal textarea::placeholder{color:#444;}
        .modal-btns{display:flex;gap:0.65rem;margin-top:1.1rem;}
        .btn-cancel{background:transparent;border:1px solid var(--border);color:var(--muted);padding:0.8rem 1.1rem;border-radius:9px;cursor:pointer;font-size:0.88rem;transition:all 0.2s;}
        .btn-cancel:hover{border-color:rgba(255,255,255,0.2);color:#fff;}
        .btn-go-approve{flex:1;background:linear-gradient(135deg,#25D366,#1ebe57);color:#fff;border:none;padding:0.8rem;border-radius:9px;font-weight:800;cursor:pointer;font-size:0.92rem;transition:opacity 0.2s;}
        .btn-go-approve:hover{opacity:0.88;}
        .btn-go-reject{flex:1;background:linear-gradient(135deg,#ff6b6b,#e05555);color:#fff;border:none;padding:0.8rem;border-radius:9px;font-weight:800;cursor:pointer;font-size:0.92rem;transition:opacity 0.2s;}
        .btn-go-reject:hover{opacity:0.88;}
        .btn-go-approve:disabled,.btn-go-reject:disabled{opacity:0.5;cursor:not-allowed;}

        /* RESPONSE CARD (off-screen for html2canvas) */
        #rc-wrap{position:fixed;left:-9999px;top:0;width:680px;z-index:-1;font-family:'Segoe UI',sans-serif;}

        @media(max-width:700px){
            .stats-grid{grid-template-columns:1fr 1fr;}
            .bcard-body,.extra-inner{grid-template-columns:1fr 1fr;}
            .main{padding:0.85rem;}
            .topbar-title{display:none;}
        }
    </style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
    <div class="topbar-left">
        <img src="BMR.png" alt="BMR">
        <div class="topbar-title">Bobby's <span>Admin</span></div>
    </div>
    <div class="topbar-right">
        <div class="live-wrap">
            <div class="live-dot"></div>
            <span class="live-label">Live</span>
        </div>
        <button class="icon-btn" id="bell-btn" title="Notifications OFF" onclick="toggleNotif()">
            <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
        </button>
        <button class="btn-logout" onclick="doLogout()">
            <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            Logout
        </button>
    </div>
</div>

<div class="main">
    <!-- STATS -->
    <div class="stats-grid">
        <div class="stat-card" style="animation-delay:.05s">
            <div class="stat-icon" style="background:rgba(244,196,48,0.1);border:1px solid rgba(244,196,48,0.2)">
                <svg viewBox="0 0 24 24" style="fill:#f4c430"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
            </div>
            <div><div class="stat-val" id="s-total">â€“</div><div class="stat-label">Total</div></div>
        </div>
        <div class="stat-card" style="animation-delay:.1s">
            <div class="stat-icon" style="background:rgba(251,146,60,0.1);border:1px solid rgba(251,146,60,0.2)">
                <svg viewBox="0 0 24 24" style="fill:#fb923c"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
            </div>
            <div><div class="stat-val" id="s-pending">â€“</div><div class="stat-label">Pending</div></div>
        </div>
        <div class="stat-card" style="animation-delay:.15s">
            <div class="stat-icon" style="background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.2)">
                <svg viewBox="0 0 24 24" style="fill:#25D366"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
            </div>
            <div><div class="stat-val" id="s-approved">â€“</div><div class="stat-label">Approved</div></div>
        </div>
        <div class="stat-card" style="animation-delay:.2s">
            <div class="stat-icon" style="background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.2)">
                <svg viewBox="0 0 24 24" style="fill:#ff6b6b"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>
            </div>
            <div><div class="stat-val" id="s-rejected">â€“</div><div class="stat-label">Rejected</div></div>
        </div>
    </div>

    <!-- FILTERS -->
    <div class="controls">
        <button class="filter-btn active" onclick="setFilter('all',this)">All <span class="cnt" id="fc-all">0</span></button>
        <button class="filter-btn" onclick="setFilter('pending',this)">Pending <span class="cnt" id="fc-pending">0</span></button>
        <button class="filter-btn" onclick="setFilter('approved',this)">Approved <span class="cnt" id="fc-approved">0</span></button>
        <button class="filter-btn" onclick="setFilter('rejected',this)">Rejected <span class="cnt" id="fc-rejected">0</span></button>
        <div class="divider"></div>
        <button class="filter-btn" onclick="setFilter('bike',this)">ğŸ Bike <span class="cnt" id="fc-bike">0</span></button>
        <button class="filter-btn" onclick="setFilter('tour',this)">ğŸš¶ Tour <span class="cnt" id="fc-tour">0</span></button>
    </div>

    <!-- SORT -->
    <div class="sort-wrap">
        <span class="sort-label">Sort:</span>
        <button class="sort-btn active" id="sb-submitted" onclick="setSort('submitted',this)">
            <svg viewBox="0 0 24 24"><path d="M3 18h6v-2H3v2zm0-5h12v-2H3v2zm0-7v2h18V6H3z"/></svg> Submitted
        </button>
        <button class="sort-btn" id="sb-date" onclick="setSort('date',this)">
            <svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg> Rental/Tour Date
        </button>
        <button class="sort-btn" id="sb-dir" onclick="toggleDir()">
            <svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>
            <span id="dir-label">Newest first</span>
        </button>
    </div>

    <!-- BOOKINGS -->
    <div class="list" id="list">
        <div class="spinner-wrap">
            <div class="spinner"></div>
            <div style="color:var(--muted);font-size:0.85rem;">Connecting to databaseâ€¦</div>
        </div>
    </div>
</div>

<!-- ACTION MODAL -->
<div class="overlay" id="modal">
    <div class="modal" id="modal-box">
        <h3 id="modal-title"></h3>
        <p id="modal-desc"></p>
        <textarea id="modal-notes" placeholder="Optional message to customerâ€¦"></textarea>
        <div class="modal-btns">
            <button class="btn-cancel" onclick="closeModal()">Cancel</button>
            <button id="modal-go"></button>
        </div>
    </div>
</div>

<!-- HIDDEN RESPONSE CARD -->
<div id="rc-wrap"><div id="rc"></div></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var fbApp = firebase.initializeApp({
    apiKey:            "AIzaSyCG1hOzMXJDQCcj-_OlmYBu9mV8xdN15bI",
    authDomain:        "bobbys-motorbike-rental.firebaseapp.com",
    projectId:         "bobbys-motorbike-rental",
    storageBucket:     "bobbys-motorbike-rental.firebasestorage.app",
    messagingSenderId: "22999361272",
    appId:             "1:22999361272:web:3f2abf58faf2e8f8e3fd0d"
});
var auth = firebase.auth();
var db   = firebase.firestore();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH GUARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
auth.onAuthStateChanged(function(user) {
    if (!user) {
        window.location.href = 'admin-login.html';
        return;
    }
    loadData();
});

function doLogout() {
    auth.signOut().then(function() { window.location.href = 'admin-login.html'; });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var allDocs    = [];
var curFilter  = 'all';
var curSort    = 'submitted';
var sortAsc    = false;
var notifOn    = false;
var prevIds    = null;
var pendingAct = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOAD DATA  â€” simple .get() first, then live updates
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadData() {
    showSpinner();

    var bikeSnap  = null;
    var tourSnap  = null;
    var bikeErr   = null;
    var tourErr   = null;

    function tryMerge() {
        if (bikeSnap === null && bikeErr === null) return; // waiting
        if (tourSnap === null && tourErr === null) return; // waiting

        var bikes = (bikeSnap ? bikeSnap.docs : []).map(function(d) {
            return Object.assign({}, d.data(), { _id: d.id, _type: 'bike' });
        });
        var tours = (tourSnap ? tourSnap.docs : []).map(function(d) {
            return Object.assign({}, d.data(), { _id: d.id, _type: 'tour' });
        });

        allDocs = bikes.concat(tours);
        cleanupExpired();
        render();

        if (bikeErr && tourErr) {
            showError(bikeErr);
        }
    }

    db.collection('bookings').get()
        .then(function(snap) { bikeSnap = snap; tryMerge(); })
        .catch(function(e)   { bikeErr  = e;    tryMerge(); });

    db.collection('tour_bookings').get()
        .then(function(snap) { tourSnap = snap; tryMerge(); })
        .catch(function(e)   { tourErr  = e;    tryMerge(); });

    // Live updates after first load
    db.collection('bookings').onSnapshot(function(snap) {
        var tours = allDocs.filter(function(d) { return d._type === 'tour'; });
        var bikes = snap.docs.map(function(d) {
            return Object.assign({}, d.data(), { _id: d.id, _type: 'bike' });
        });
        allDocs = bikes.concat(tours);
        checkNew();
        render();
    }, function(e) { console.warn('Bike live updates paused:', e.code); });

    db.collection('tour_bookings').onSnapshot(function(snap) {
        var bikes = allDocs.filter(function(d) { return d._type === 'bike'; });
        var tours = snap.docs.map(function(d) {
            return Object.assign({}, d.data(), { _id: d.id, _type: 'tour' });
        });
        allDocs = bikes.concat(tours);
        checkNew();
        render();
    }, function(e) { console.warn('Tour live updates paused:', e.code); });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLEANUP EXPIRED (client-side, no index needed)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cleanupExpired() {
    var now = new Date();
    allDocs.forEach(function(doc) {
        if (!doc.expiresAt) return;
        var exp = doc.expiresAt.toDate ? doc.expiresAt.toDate() : new Date(doc.expiresAt);
        if (exp <= now) {
            var col = doc._type === 'bike' ? 'bookings' : 'tour_bookings';
            db.collection(col).doc(doc._id).delete().catch(function() {});
        }
    });
    allDocs = allDocs.filter(function(doc) {
        if (!doc.expiresAt) return true;
        var exp = doc.expiresAt.toDate ? doc.expiresAt.toDate() : new Date(doc.expiresAt);
        return exp > now;
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI STATE HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSpinner() {
    document.getElementById('list').innerHTML =
        '<div class="spinner-wrap"><div class="spinner"></div>' +
        '<div style="color:var(--muted);font-size:0.85rem;">Connecting to databaseâ€¦</div></div>';
}

function showError(err) {
    var code = err ? (err.code || '') : '';
    var msg = code === 'permission-denied'
        ? 'Permission denied. Check your Firestore Security Rules.'
        : 'Could not reach database. Check your internet connection. (' + code + ')';
    document.getElementById('list').innerHTML =
        '<div class="state-box"><svg viewBox="0 0 24 24" style="fill:#ff6b6b;opacity:0.7">' +
        '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>' +
        '</svg><h3 style="color:#ff6b6b">Connection Failed</h3><p style="font-size:.83rem;max-width:360px;margin:.5rem auto;line-height:1.6">' +
        msg + '</p></div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
    updateStats();
    var list = document.getElementById('list');
    var docs = getFiltered();

    if (!docs.length) {
        list.innerHTML = '<div class="state-box"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>' +
            '<h3>No bookings yet</h3><p>New bookings will appear here in real time</p></div>';
        return;
    }

    list.innerHTML = docs.map(buildCard).join('');
}

function updateStats() {
    var tot = allDocs.length;
    var pen = allDocs.filter(function(d){return d.status==='pending';}).length;
    var app = allDocs.filter(function(d){return d.status==='approved';}).length;
    var rej = allDocs.filter(function(d){return d.status==='rejected';}).length;
    var bk  = allDocs.filter(function(d){return d._type==='bike';}).length;
    var tr  = allDocs.filter(function(d){return d._type==='tour';}).length;
    document.getElementById('s-total').textContent    = tot;
    document.getElementById('s-pending').textContent  = pen;
    document.getElementById('s-approved').textContent = app;
    document.getElementById('s-rejected').textContent = rej;
    document.getElementById('fc-all').textContent      = tot;
    document.getElementById('fc-pending').textContent  = pen;
    document.getElementById('fc-approved').textContent = app;
    document.getElementById('fc-rejected').textContent = rej;
    document.getElementById('fc-bike').textContent     = bk;
    document.getElementById('fc-tour').textContent     = tr;
}

function getFiltered() {
    var list = allDocs.filter(function(d) {
        if (curFilter === 'bike')     return d._type   === 'bike';
        if (curFilter === 'tour')     return d._type   === 'tour';
        if (curFilter === 'pending')  return d.status  === 'pending';
        if (curFilter === 'approved') return d.status  === 'approved';
        if (curFilter === 'rejected') return d.status  === 'rejected';
        return true;
    });
    list.sort(function(a, b) {
        var av, bv;
        if (curSort === 'date') {
            av = new Date(a.startDate || a.tourDate || a.formattedDate || 0).getTime();
            bv = new Date(b.startDate || b.tourDate || b.formattedDate || 0).getTime();
        } else {
            av = a.createdAt ? a.createdAt.toMillis() : 0;
            bv = b.createdAt ? b.createdAt.toMillis() : 0;
        }
        return sortAsc ? av - bv : bv - av;
    });
    return list;
}

function buildCard(d) {
    var isBike  = d._type === 'bike';
    var st      = d.status || 'pending';
    var stLabel = st.charAt(0).toUpperCase() + st.slice(1);

    var mainFields = isBike
        ? [
            cf('Customer',  d.name),
            cf('Bike',      '<span class="gold">' + x(d.bikeName) + '</span>'),
            cf('Date',      x(d.formattedDate || 'â€“')),
            cf('Duration',  x(d.rentalDays) + 'd Â· ' + x(d.numBikes) + ' bike(s)'),
            cf('Total',     '<span class="gold">â‚±' + Number(d.totalPrice||0).toLocaleString() + '</span>'),
            cf('Contact',   x(d.phone))
          ]
        : [
            cf('Customer',  d.name),
            cf('Date',      '<span class="teal">' + x(d.formattedDate || 'â€“') + '</span>'),
            cf('Start',     x(d.startTime || 'â€“')),
            cf('Total',     '<span class="teal">â‚±840</span>'),
            cf('Contact',   x(d.phone)),
            cf('Requests',  x(d.stops || 'None'))
          ];

    var extraFields = isBike
        ? [cf('Gender',d.gender),cf('Nationality',d.nationality),cf('Age',d.age),cf('Accommodation',d.location),cf('Helmets',d.helmets),cf('Deposit','â‚±'+Number(d.depositAmount||d.bikePrice||0).toLocaleString())]
        : [cf('Gender',d.gender),cf('Nationality',d.nationality),cf('Age',d.age),cf('Accommodation',d.location),cf('Duration','8 Hours'),cf('Special',d.stops||'None')];

    var actions = '';
    if (st === 'pending') {
        actions =
            '<button class="btn-approve" onclick="openModal(\'' + d._id + '\',\'' + d._type + '\',\'approve\')">' +
            '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>Approve</button>' +
            '<button class="btn-reject" onclick="openModal(\'' + d._id + '\',\'' + d._type + '\',\'reject\')">' +
            '<svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>Reject</button>' +
            '<button class="btn-del" onclick="delBooking(\'' + d._id + '\',\'' + d._type + '\')" title="Delete">' +
            '<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>';
    } else {
        var note = d.adminNotes ? '<span class="note-text">"' + x(d.adminNotes) + '"</span>' : '';
        actions = note +
            '<button class="btn-dl" onclick="dlResponse(\'' + d._id + '\',\'' + d._type + '\')">' +
            '<svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>Download ' + stLabel + ' Card</button>' +
            '<button class="btn-del" onclick="delBooking(\'' + d._id + '\',\'' + d._type + '\')" title="Delete">' +
            '<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>';
    }

    return '<div class="bcard ' + (isBike ? 'bike' : 'tour') + ' ' + st + '">' +
        '<div class="bcard-top">' +
            '<div class="bcard-top-left">' +
                '<span class="badge-type ' + (isBike ? 'bike' : 'tour') + '">' + (isBike ? 'Bike' : 'Tour') + '</span>' +
                '<span class="bid">' + x(d.bookingID) + '</span>' +
                '<span class="badge-status ' + st + '">' + stLabel + '</span>' +
            '</div>' +
            '<div class="bcard-right">' +
                '<span class="card-time">' + timeAgo(d.createdAt) + '</span>' +
                '<button class="btn-expand" id="exp-' + d._id + '" onclick="toggleExp(\'' + d._id + '\')">' +
                '<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>More</button>' +
            '</div>' +
        '</div>' +
        '<div class="bcard-body">' + mainFields.join('') + '</div>' +
        '<div class="extra" id="ex-' + d._id + '"><div class="extra-inner">' + extraFields.join('') + '</div></div>' +
        '<div class="bcard-actions">' + actions + '</div>' +
    '</div>';
}

function cf(label, val) {
    return '<div class="cf"><label>' + label + '</label><span>' + (val || 'â€“') + '</span></div>';
}
function x(s) {
    return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function timeAgo(ts) {
    if (!ts || !ts.toMillis) return 'â€“';
    var m = Math.floor((Date.now() - ts.toMillis()) / 60000);
    if (m < 1) return 'Just now';
    if (m < 60) return m + 'm ago';
    var h = Math.floor(m / 60);
    if (h < 24) return h + 'h ago';
    return Math.floor(h / 24) + 'd ago';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERS / SORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFilter(f, btn) {
    curFilter = f;
    document.querySelectorAll('.filter-btn').forEach(function(b){b.classList.remove('active');});
    btn.classList.add('active');
    render();
}
function setSort(s, btn) {
    curSort = s;
    document.querySelectorAll('.sort-btn:not(#sb-dir)').forEach(function(b){b.classList.remove('active');});
    btn.classList.add('active');
    render();
}
function toggleDir() {
    sortAsc = !sortAsc;
    document.getElementById('sb-dir').classList.toggle('active', sortAsc);
    document.getElementById('dir-label').textContent = sortAsc ? 'Oldest first' : 'Newest first';
    render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPAND CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleExp(id) {
    var ex  = document.getElementById('ex-' + id);
    var btn = document.getElementById('exp-' + id);
    var open = ex.classList.toggle('open');
    btn.classList.toggle('open', open);
    btn.innerHTML = open
        ? '<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>Less'
        : '<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>More';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPROVE / REJECT MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id, type, action) {
    pendingAct = { id: id, type: type, action: action };
    var doc = allDocs.find(function(d){ return d._id === id; });
    var name = doc ? doc.name : 'this customer';
    var box = document.getElementById('modal-box');
    var title = document.getElementById('modal-title');
    var desc  = document.getElementById('modal-desc');
    var go    = document.getElementById('modal-go');
    var notes = document.getElementById('modal-notes');
    notes.value = '';

    if (action === 'approve') {
        box.className = 'modal approve';
        title.className = 'g'; title.textContent = 'Approve Booking';
        desc.textContent = 'Confirm booking for ' + name + '. Add an optional message.';
        notes.placeholder = 'e.g. See you on the day! Please bring your ID.';
        go.className = 'btn-go-approve'; go.textContent = 'âœ“ Confirm Approval';
    } else {
        box.className = 'modal reject';
        title.className = 'r'; title.textContent = 'Reject Booking';
        desc.textContent = 'Reject booking for ' + name + '. Please give a reason.';
        notes.placeholder = 'e.g. Sorry, the bike is not available on that date.';
        go.className = 'btn-go-reject'; go.textContent = 'âœ• Confirm Rejection';
    }
    go.onclick = confirmAction;
    document.getElementById('modal').classList.add('show');
}

function closeModal() {
    document.getElementById('modal').classList.remove('show');
    pendingAct = null;
}

document.getElementById('modal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

function confirmAction() {
    if (!pendingAct) return;
    var go  = document.getElementById('modal-go');
    var col = pendingAct.type === 'bike' ? 'bookings' : 'tour_bookings';
    var status = pendingAct.action === 'approve' ? 'approved' : 'rejected';
    var notes  = document.getElementById('modal-notes').value.trim();
    go.disabled = true; go.textContent = 'Savingâ€¦';
    db.collection(col).doc(pendingAct.id).update({
        status: status,
        adminNotes: notes,
        processedAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(function() {
        closeModal();
    }).catch(function(e) {
        go.disabled = false; go.textContent = 'Try Again';
        console.error('Update error:', e);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function delBooking(id, type) {
    if (!confirm('Delete this booking? This cannot be undone.')) return;
    var col = type === 'bike' ? 'bookings' : 'tour_bookings';
    db.collection(col).doc(id).delete().catch(function(e){ alert('Delete failed: ' + e.message); });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATION SOUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkNew() {
    var ids = allDocs.map(function(d){return d._id;}).sort().join(',');
    if (prevIds === null) { prevIds = ids; return; }
    if (ids !== prevIds && notifOn) {
        var oldSet = prevIds.split(',');
        var hasNew = allDocs.some(function(d){ return !oldSet.includes(d._id); });
        if (hasNew) pingSound();
    }
    prevIds = ids;
}

function toggleNotif() {
    notifOn = !notifOn;
    var btn = document.getElementById('bell-btn');
    btn.classList.toggle('on', notifOn);
    btn.title = notifOn ? 'Notifications ON' : 'Notifications OFF';
    if (notifOn) pingSound();
}

function pingSound() {
    try {
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        [523, 659, 784].forEach(function(freq, i) {
            var o = ctx.createOscillator(), g = ctx.createGain();
            o.connect(g); g.connect(ctx.destination);
            o.type = 'sine'; o.frequency.value = freq;
            var t = ctx.currentTime + i * 0.13;
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(0.18, t + 0.04);
            g.gain.exponentialRampToValueAtTime(0.001, t + 0.38);
            o.start(t); o.stop(t + 0.4);
        });
        var btn = document.getElementById('bell-btn');
        btn.classList.add('ring');
        setTimeout(function(){ btn.classList.remove('ring'); }, 700);
    } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD RESPONSE CARD (PNG)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dlResponse(id, type) {
    var d = allDocs.find(function(x){ return x._id === id; });
    if (!d) return;
    buildRC(d);
    setTimeout(function() {
        html2canvas(document.getElementById('rc'), {
            backgroundColor: d.status === 'approved' ? '#071410' : '#100a0a',
            scale: 2, useCORS: true, logging: false, width: 680
        }).then(function(canvas) {
            var a = document.createElement('a');
            a.href = canvas.toDataURL('image/png');
            a.download = 'BMR-' + (d.status === 'approved' ? 'Approved' : 'Rejected') + '-' + (d.bookingID || id) + '.png';
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        });
    }, 180);
}

function buildRC(d) {
    var ok  = d.status === 'approved';
    var ac  = ok ? '#14b878' : '#ff6b6b';
    var bg  = ok ? '#071410' : '#100a0a';
    var bg2 = ok ? '#0d1f18' : '#1a0c0c';
    var rgbAc = ok ? '20,184,120' : '255,107,107';
    var today = new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    var note  = d.adminNotes || (ok ? 'Your booking is confirmed! See you soon.' : 'We are unable to accommodate your request.');
    var isBike = d._type === 'bike';
    var rows = isBike
        ? [rcRow('Customer', d.name), rcRow('Bike', d.bikeName), rcRow('Date', d.formattedDate), rcRow('Duration', d.rentalDays + ' day(s) Â· ' + d.numBikes + ' bike(s)'), rcRow('Total', '&#8369;' + Number(d.totalPrice||0).toLocaleString())]
        : [rcRow('Customer', d.name), rcRow('Tour Date', d.formattedDate), rcRow('Start Time', d.startTime), rcRow('Duration', '8 Hours'), rcRow('Total', '&#8369;840 flat rate')];

    document.getElementById('rc').innerHTML = [
        '<div style="background:' + bg + ';overflow:hidden;">',
        '<div style="height:5px;background:linear-gradient(90deg,' + ac + ',#f4c430,' + ac + ')"></div>',
        '<div style="padding:24px 30px 20px;background:' + bg2 + ';border-bottom:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center;">',
        '<div style="color:#fff;font-size:1rem;font-weight:800;">Bobby\'s Motorbike Rental <span style="color:#888;font-size:0.72rem;font-weight:400;">Â· Santa Fe, Bantayan Island</span></div>',
        '<div style="color:#555;font-size:0.7rem;">' + today + '</div></div>',
        '<div style="padding:26px 30px;text-align:center;background:rgba(' + rgbAc + ',0.07);border-bottom:1px solid rgba(255,255,255,0.06);">',
        '<div style="font-size:2.6rem;font-weight:900;color:' + ac + ';letter-spacing:4px;">' + (ok ? 'CONFIRMED' : 'DECLINED') + '</div>',
        '<div style="color:#888;font-size:0.72rem;text-transform:uppercase;letter-spacing:2px;margin-top:6px;">Booking ' + (ok ? 'Approved' : 'Rejected') + '</div>',
        '<div style="display:inline-block;background:rgba(' + rgbAc + ',0.1);border:1px solid rgba(' + rgbAc + ',0.3);color:' + ac + ';font-size:1.05rem;font-weight:800;padding:5px 18px;border-radius:25px;margin-top:10px;letter-spacing:2px;">' + x(d.bookingID || 'â€“') + '</div></div>',
        '<div style="padding:20px 30px;"><div style="color:' + ac + ';font-size:0.63rem;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;">Booking Details</div>',
        '<table style="width:100%;border-collapse:collapse;">' + rows.join('') + '</table></div>',
        '<div style="border-top:1px solid rgba(255,255,255,0.06);padding:20px 30px;">',
        '<div style="color:' + ac + ';font-size:0.63rem;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;">Message</div>',
        '<div style="background:rgba(' + rgbAc + ',0.07);border:1px solid rgba(' + rgbAc + ',0.2);border-radius:10px;padding:12px 14px;color:#ddd;font-size:0.88rem;line-height:1.6;font-style:italic;">"' + x(note) + '"</div></div>',
        '<div style="padding:14px 30px;border-top:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center;background:' + bg2 + ';">',
        '<div style="color:#666;font-size:0.7rem;">Bobby\'s Motorbike Rental Â· bobbymotorental.xyz</div>',
        '<div style="color:#25D366;font-size:0.7rem;font-weight:700;">+63 907 352 7234</div></div>',
        '<div style="height:3px;background:linear-gradient(90deg,#f4c430,' + ac + ',#f4c430)"></div>',
        '</div>'
    ].join('');
}

function rcRow(label, val) {
    return '<tr style="border-bottom:1px solid rgba(255,255,255,0.05)">' +
        '<td style="color:#888;font-size:0.72rem;text-transform:uppercase;letter-spacing:1px;padding:6px 0;padding-right:14px;white-space:nowrap">' + label + '</td>' +
        '<td style="color:#fff;font-size:0.86rem;font-weight:600;padding:6px 0">' + (val || 'â€“') + '</td></tr>';
}
</script>
</body>
</html>
